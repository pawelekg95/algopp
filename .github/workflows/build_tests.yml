name: Build_tests
on:
  workflow_call:
    inputs:
      preset:
        required: true
        type: string
      app:
        required: true
        type: string

jobs:
  Build_tests:
    runs-on: ubuntu-20.04
    container:
      image: ghcr.io/pawelekg95/calgopp_x86_64:${{ github.sha }}
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.github_token }}
    steps:
      - uses: actions/checkout@v3
      - run: |
          BUILD_DIR="/tmp/${{ inputs.app }}-${{ github.sha }}"
          rm -rf "${BUILD_DIR}"
          mkdir "${BUILD_DIR}"
          cd "${BUILD_DIR}"
          cmake ${{ github.workspace }} --preset ${{ inputs.preset }}
          make -j 2
